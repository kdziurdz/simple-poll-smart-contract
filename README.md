# Simple poll Web3j example

### Purpose
The project is a simple showcase implementation of a smart contract 
and example client - server classes, that directly interact with smart contract 
via wrapper generated by [Web3j plugin](https://github.com/web3j/web3j-gradle-plugin)

[Solidity](https://docs.soliditylang.org/en/v0.8.2/) language is not main point of concern here,
rather than interactions with [Web3j](http://docs.web3j.io/latest/) library
and approach to the integration testing.

### Running prerequisites
In order to run full showcase an Ethereum node and three accounts
with small amount of Ether should be known.
The most convenient way is to run [Ganache](https://www.trufflesuite.com/docs/ganache/overview).

Node URL and accounts' private keys can be gathered from the main dashboard of Ganache workspace.
`PollShowcase` class static fields are places to store showcase data.

```java
public class PollShowcase {
    private static final Logger log = LoggerFactory.getLogger(PollShowcase.class);

    static final String nodeUrl = "<node-url>";
    static final String privateKey1 = "<private-key-1>";
    static final String privateKey2 = "<private-key-2>";
    static final String privateKey3 = "<private-key-3>";

    public static void main(String[] args) throws Exception {
```
### Building and running

Clean & build without tests
```shell
./gradlew clean build run -x test
```

Clean & build & test
```shell
./gradlew clean build run
```

Run after build
```shell
./gradlew run
```

### Showcase flow
1. Construct Web3j handler
2. Generate credentials/accounts
3. Deploy contract using `PollServer` class
4. Get available options, vote, and get winner using `PollClient`

It's worth to notice that `pollClient3` is used by totally new account
that has been generated in runtime. Due to this fact, a small amount ot Ether
needs to be transferred to that account in order to let it vote and pay the gas.


### Testing
There are two kinds of Ethereum Virtual Machine used in the project
- EMBEDDED - leverages `web3j-evm` to run EVM in-memory.
    No external dependencies needed and tests execution is pretty fast.
- BESU - required docker daemon to be running in the background. Execution is significantly slower.

Embedded one seems to be less reliable and predictable, nevertheless we can benefit from its lightweightness. 
Test kind can be distinguished by `@EVMTest` annotation and by the test suite name.

`TestData` class provides common handlers to dealing with credentials and data initialization.

`*EmbeddedTest` and  `*BesuTest` classes could be refactored to not repeat themselves, though due to the fact that 
the project is created only for demo purposes, it would lower the readability.

To run all tests
```shell
./gradlew test
```
To run all tests except BESU (if no docker available)
```shell
./gradlew testNoBesu
```

### Generate similar project
A sample project that consist of `HelloWorld.sol` can be generated via [Web3j CLI](https://docs.web3j.io/latest/command_line_tools/)
